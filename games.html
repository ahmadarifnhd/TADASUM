<!DOCTYPE html>
<html>
<head>
    <title>TADASUM</title>
    <link rel="icon" href="image/Logo.png" type="image/png">

    <style>
        body {
            background-color: #000000;
        }

        .header {
            padding: 50px;
            color: #fff;
            margin: 0 auto;
            margin-bottom: 40px;
        }

        .header h1 {
            text-align: center;
            font-size: 40px;
        }

        .header p {
            text-align: center;
            font-size: 25px;
        }

        .wheel {
            display: flex;
            justify-content: center;
            position: relative;
        }

        .center-circle {
            width: 80px;
            height: 80px;
            border-radius: 60px;
            background-color: #fff;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }

        .triangle {
            display: none; /* Default: hide the triangle */
            width: 0;
            height: 0;
            border-top: 20px solid transparent;
            border-bottom: 20px solid transparent;
            border-right: 50px solid white;
            position: absolute;
            top: 50%;
            right: -355%;
            transform: translateY(-50%);
        }

        textarea {
            background-color: rgba(20, 20, 20, 0.2);
            caret-color: #fff;
            resize: none;
            color: #fff;
        }

        .inputArea {
            display: flex;
            justify-content: center;
            margin-top: 40px;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>YOU GET</h1>
        <p id="winner">NONE</p>
    </div>
    <div class="wheel">
        <canvas id="canvas" width="600" height="600"></canvas>
        <div class="center-circle" onclick="spin()">
            <div class="triangle" id="triangle"></div> <!-- Triangle element -->
        </div>
    </div>
    <div class="inputArea" style="display: none;" onchange="createWheel()">
        <textarea rows="20" cols="30">Nice Try
    Cut Rp.1000
    Cut Rp.2000
    Cut Rp.3000
    Free 1 Box S</textarea>
    </div>

    <script>
        function randomColor() {
            r = Math.floor(Math.random() * 255);
            g = Math.floor(Math.random() * 255);
            b = Math.floor(Math.random() * 255);
            return { r, g, b };
        }

        function toRad(deg) {
            return deg * (Math.PI / 180.0);
        }

        function randomRange(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const width = canvas.width;
        const height = canvas.height;

        const centerX = width / 2;
        const centerY = height / 2;
        const radius = width / 2;

        let items = document.getElementsByTagName("textarea")[0].value.split("\n");
        let step = 360 / items.length;
        let colors = [];
        let currentDeg = 0;
        let spinning = true; // To track if the wheel is spinning before spin button

        for (let i = 0; i < items.length + 1; i++) {
            colors.push(randomColor());
        }

        function draw() {
            ctx.clearRect(0, 0, width, height); // Clear the canvas
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, toRad(0), toRad(360));
            ctx.fillStyle = rgb(${33},${33},${33});
            ctx.lineTo(centerX, centerY);
            ctx.fill();

            let startDeg = currentDeg;
            for (let i = 0; i < items.length; i++, startDeg += step) {
                let endDeg = startDeg + step;

                const color = colors[i];
                const colorStyle = rgb(${color.r},${color.g},${color.b});

                ctx.beginPath();
                ctx.arc(centerX, centerY, radius - 2, toRad(startDeg), toRad(endDeg));
                const colorStyle2 = rgb(${color.r - 30},${color.g - 30},${color.b - 30});
                ctx.fillStyle = colorStyle2;
                ctx.lineTo(centerX, centerY);
                ctx.fill();

                ctx.beginPath();
                ctx.arc(centerX, centerY, radius - 30, toRad(startDeg), toRad(endDeg));
                ctx.fillStyle = colorStyle;
                ctx.lineTo(centerX, centerY);
                ctx.fill();

                // Draw text
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(toRad((startDeg + endDeg) / 2));
                ctx.textAlign = "center";
                ctx.fillStyle = color.r > 150 || color.g > 150 || color.b > 150 ? "#000" : "#fff";
                ctx.font = 'bold 28px serif';
                ctx.fillText(items[i], 130, 10);
                ctx.restore();
            }
        }

        function animateInitial() {
            if (spinning) {
                currentDeg += 2; // Spin speed for initial animation
                draw();
                requestAnimationFrame(animateInitial);
            }
        }

        // Initial animation starts when the page loads
        animateInitial();

        function spin() {
            if (!spinning) {
                return; // Prevent multiple spins at the same time
            }

            // Stop initial spinning
            spinning = false;

            // Show the triangle
            document.getElementById("triangle").style.display = "block";

            // Start the spin animation
            let maxRotation = randomRange(360 * 5, 360 * 8);
            let speed = 20;

            function animateSpin() {
                if (speed > 0) {
                    currentDeg += speed;
                    draw();
                    speed *= 0.98; // Gradual slowing down
                    if (speed < 0.5) {
                        speed = 0; // Stop spinning
                        const finalPosition = (360 - (currentDeg % 360)) % 360; // Get final position
                        const selectedItemIndex = Math.floor(finalPosition / step); // Determine which item the wheel stopped on
                        const selectedItem = items[selectedItemIndex];
                        document.getElementById("winner").innerHTML = selectedItem; // Update "YOU GET" text
                    }
                    requestAnimationFrame(animateSpin);
                }
            }

            animateSpin();
        }
    </script>
</body>
</html>
